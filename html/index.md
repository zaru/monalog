## Markdown構文木とレンダー
2026/02/01
以前作成したMarkdownパーサはパーサと言うよりコンバーターみたいなものでMarkdownファイルを読み込んで、その場でHTMLに変換しているだけのものだった。これだと今後の拡張がどう考えても大変そう。ということで、構文木、いわゆるASTを作ってからレンダリングするように変更した。
ASTをHaskellの型で表現するには代数的データ型というのを使うらしい。なんだよ代数って。
実装の一部、インラインについて抜粋する。

```
data Inline
  = Plain Text
  | Code Text
  | Strong [Inline] -- 再帰にして strong 内に他のInlineを埋め込めるようにする
  deriving (Show, Eq)
```

プレーンテキスト、`<code>` と `<strong>` について定義。`<strong>` は中に `<strong><code>foo</code></strong>` というネスト構造が考えられるので再帰定義にしている。

この代数的データ型はレンダリングのときに力を発揮する。型の条件分岐がスッキリ書ける。

```
renderInline :: Inline -> Text
renderInline (Plain line) = line
renderInline (Code line) = "<code>" <> line <> "</code>"
renderInline (Strong line) = "<strong>" <> T.concat (map renderInline line) <> "</strong>"
```

このコードをすっと書けた時、正直感動した。JavaScriptでこれを書こうとすると、どうしても見た目が野暮ったくなるし、途中で記載ミスをしてしまいそうだ。でもHaskellは書き漏れたパターンがあったら警告してくれる。すごい。


## コードブロックをサポート
2026/01/30
Markdownパーサを改良しコードブロックに対応した。めでたい。

```
add :: Int -> Int -> Int
add x y = x + y
add 1 2
```

パズルを作っているような気持ちになる。再帰処理がでてきた。果たしてパフォーマンスはどうなのか。ぜんぜん分からないけど、とりあえず動いているから良しとする。オーバーロードのような？型ごとに関数を複数定義する書き方に慣れてない。でも楽しい。

そしてガードを初めて使ったが非常に便利。こんなん使い始めたらif-elseを書いてくのが面倒になる。

```
drink :: Int -> String
drink age
  | age > 19 = "ビア"
  | age < 10 = "こどもビア"
  | otherwise = "おみず"
```


## Markdownパーサ作り開始
2026/01/29
HaskellでMarkdownパーサを作り始めた。まだ貧弱なパーサで、 `##`の h2 タグしか対応していない。それ以外はすべて段落扱いにしている。改行ごとに分割して先頭が `##` ならh2にするという単純な処理。完璧なパーサは今はいらない。ブログがかければ十分なものを目指す。
そして初めてCase式を使ってJust/Nothingで分岐処理してHaskellらしさを体験できたので良しとする。楽しいぞこれ。
困ったのは文字列操作で、知見がないので当初はByteStringで処理していたが、置換を考えるとText型が良いとヒントを貰ったので、Data.Textパッケージを利用。なるべくライブラリは使わず自力処理したいが、そんなスキルはまだない。
あとはデプロイ先をRenderからKoyebに変更した。Koyeb(なんて発音するんだ)は東京リージョンがあり、めっちゃ貧弱で安いインスタンスがあるので安価にデプロイできる。料金は約$2.68/月。お安いね。 Cloud Runもいいが常時起動にしておきたいので避けた。
あとはDockerイメージビルドに時間がかかるのをなんとかしたい。

## My first Haskell blog
2026/01/26
Haskell勉強の一環でブログを作ることにした。このブログはHaskellで動いている。副作用の嵐なのでまだHaskellらしい純粋関数はまったく出てこないが、とりあえず動いているので最初の第一歩とする。
どなたかが𝕏でつぶやいてた「ゲームを完成させるコツは、一番最初にゲームスタート画面、そしてスタートしたら即ゲームオーバーさせる。これですでにゲームは完成している。あとは肉付けしていくだけ」（うろ覚え）という言葉が良かったので、それにならってブログシステムとしては全く足りていないが、記事があり公開されていればそれで完成である。
今後、少しずつ機能を付け足しながらHaskellを楽しんでいこうと思う。
デプロイ先はRenderの無料枠でシンガポールリージョンを利用。いずれ東京リージョンのあるサービスに乗り換えたい。KoyebもしくはCloud
